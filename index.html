<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PokéMMO • Gym Rerun (Aleatorios)</title>
  <style>
    :root{--bg:#070707;--panel:#111;--muted:#9aa0a6;--accent:#ffcc00;--line:#222}
    *{box-sizing:border-box}
    body{font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",sans-serif;background:var(--bg);color:#eee;margin:0}
    header{padding:20px;text-align:center;border-bottom:1px solid var(--line)}
    h1{margin:0;color:var(--accent)}
    .wrap{max-width:1100px;margin:18px auto;padding:18px}
    .tools{display:flex;gap:10px;margin-bottom:12px}
    input.search{flex:1;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f0f0f;color:#eee}
    .btn{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#121212;color:#eee;cursor:pointer}
    .hint{font-size:13px;color:var(--muted);margin-top:6px;text-align:center}

    .region{background:#0f0f0f;border:1px solid var(--line);padding:12px;border-radius:10px;margin-bottom:12px}
    .region .head{display:flex;align-items:center;gap:10px;cursor:pointer}
    .tag{font-size:12px;color:var(--muted)}

    ul{list-style:none;padding-left:18px;margin:8px 0}
    li{display:flex;align-items:center;gap:10px;padding:6px;border-radius:8px}
    li.leader{cursor:pointer}
    li.leader:hover, li.pkm:hover{background:#1a1a1a}

    img.icon{width:34px;height:34px;image-rendering:pixelated;border-radius:6px;background:#000}
    img.icon.pkm{width:28px;height:28px}

    .nested{display:none;margin-left:8px}
    .active > .nested{display:block}

    #infoBox{margin-top:14px;padding:12px;border-radius:10px;background:#0f0f0f;border:1px solid var(--line);display:none}
    footer{padding:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <header>
    <h1>PokéMMO • Gym Rerun — Plantilla con equipos aleatorios</h1>
    <div class="hint">Cada recarga genera equipos aleatorios (6 pokémon por líder). Luego puedes reemplazar por los reales.</div>
  </header>

  <div class="wrap">
    <div class="tools">
      <input id="search" class="search" placeholder="Buscar región, líder o pokémon…" />
      <button id="refresh" class="btn">Re-generar equipos</button>
      <button id="expandAll" class="btn">Expandir todo</button>
      <button id="collapseAll" class="btn">Cerrar todo</button>
    </div>

    <div id="treeRoot"></div>
    <div id="infoBox"></div>
  </div>

  <footer>Sprites: Pokémon Showdown • Plantilla creada para PokéMMO</footer>

  <script>
    // Lista de líderes por región (sin teams; se generan aleatorios)
    const REGIONS = [
      {region:'Kanto', code:'kanto', leaders:['Brock','Misty','Lt. Surge','Erika','Koga','Sabrina','Blaine','Giovanni']},
      {region:'Johto', code:'johto', leaders:['Falkner','Bugsy','Whitney','Morty','Chuck','Jasmine','Pryce','Clair']},
      {region:'Hoenn', code:'hoenn', leaders:['Roxanne','Brawly','Wattson','Flannery','Norman','Winona','Tate & Liza','Wallace']},
      {region:'Sinnoh', code:'sinnoh', leaders:['Roark','Gardenia','Maylene','Crasher Wake','Fantina','Byron','Candice','Volkner']},
      {region:'Unova', code:'unova', leaders:['Cilan/Chili/Cress','Lenora','Burgh','Elesa','Clay','Skyla','Brycen','Drayden/Iris']}
    ];

    // Pool de pokémon para seleccionar aleatorio (nombres compatibles con Showdown gen5)
    const POOL = [
      'geodude','onix','golem','rhyhorn','kabuto','aerodactyl','starmie','gyarados','vaporeon','jolteon','flareon',
      'raichu','magneton','vileplume','victreebel','roserade','torterra','lucario','slaking','altaria','milotic',
      'manectric','metagross','aggron','talonflame','pidgeot','scizor','heracross','miltank','clefable','snorlax',
      'gengar','mismagius','chandelure','drifblim','hydreigon','haxorus','excadrill','krookodile','seismitoad','mamoswine',
      'braviary','swanna','swellow','archeops','rotom','rotom-wash','rotom-heat','rotom-fan','rotom-frost','rotom-mow',
      'togekiss','blaziken','sceptile','swampert','sliggoo','goodra','greninja','tyranitar','scrafty','umbreon',
      'espeon','glaceon','leafeon','vulpix','ninetales','charizard','blastoise','venusaur','alakazam','metagross'
    ];

    const TRAINER_BASE = 'https://play.pokemonshowdown.com/sprites/trainers/';
    const PKM_BASE = 'https://play.pokemonshowdown.com/sprites/gen5/';

    function slugify(name){
      // Keep dots for forms like mr.mime, rotom-wash already with dash handled in POOL
      return name.toLowerCase().replace(/[^a-z0-9-\.]/g,'');
    }

    function createImg(src, alt, cls=''){
      const img = document.createElement('img');
      img.src = src; img.alt = alt; img.className = 'icon ' + cls;
      img.onerror = ()=>{ img.src = `data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32'><rect width='32' height='32' fill='%23000'/><text x='16' y='20' font-size='12' text-anchor='middle' fill='%23fff'>?</text></svg>` };
      return img;
    }

    function pkmUrl(name){ return PKM_BASE + (name.endsWith('.png')?name:slugify(name)+'.png'); }
    function trainerUrl(name){ return TRAINER_BASE + (name.toLowerCase().replace(/[^a-z0-9-\.]/g,'') || 'unknown') + '.png'; }

    // Genera N elementos aleatorios sin repetir
    function pickRandom(pool, n){
      const copy = pool.slice();
      const out = [];
      for(let i=0;i<n && copy.length;i++){
        const idx = Math.floor(Math.random()*copy.length);
        out.push(copy.splice(idx,1)[0]);
      }
      return out;
    }

    // Render
    const root = document.getElementById('treeRoot');

    function buildTree(){
      root.innerHTML = '';
      REGIONS.forEach(region=>{
        const box = document.createElement('div'); box.className='region';
        const head = document.createElement('div'); head.className='head';
        head.addEventListener('click', e=>{ head.parentElement.classList.toggle('active'); e.stopPropagation(); });
        const img = createImg(`https://play.pokemonshowdown.com/sprites/trainers/${region.code}.png`, region.region);
        head.appendChild(img);
        const title = document.createElement('div'); title.innerHTML = `<strong>${region.region}</strong> <span class='tag'>${region.leaders.length} líderes</span>`;
        head.appendChild(title);
        box.appendChild(head);

        const leadersUl = document.createElement('ul'); leadersUl.className='nested';

        region.leaders.forEach(ldr=>{
          const leaderLi = document.createElement('li'); leaderLi.className='leader';
          leaderLi.addEventListener('click', e=>{ leaderLi.classList.toggle('active'); e.stopPropagation(); });

          const limg = createImg(trainerUrl(ldr), ldr);
          leaderLi.appendChild(limg);
          leaderLi.appendChild(document.createTextNode(' ' + ldr));

          // team random
          const team = pickRandom(POOL,6);
          const teamUl = document.createElement('ul'); teamUl.className='nested';
          team.forEach(mon=>{
            const monLi = document.createElement('li'); monLi.className='pkm';
            monLi.addEventListener('click', e=>{ showInfo(mon, 'Estrategia placeholder: ajusta según Gym Rerun'); e.stopPropagation(); });
            const mimg = createImg(pkmUrl(mon), mon, 'pkm');
            monLi.appendChild(mimg);
            monLi.appendChild(document.createTextNode(' ' + mon));
            teamUl.appendChild(monLi);
          });

          leaderLi.appendChild(teamUl);
          leadersUl.appendChild(leaderLi);
        });

        box.appendChild(leadersUl);
        root.appendChild(box);
      });
    }

    function showInfo(pokemon, texto){
      const box = document.getElementById('infoBox');
      box.innerHTML = `<b>${pokemon}</b>: ${texto}`; box.style.display='block';
    }

    // Events
    document.getElementById('refresh').addEventListener('click', ()=>{ buildTree(); });
    document.getElementById('expandAll').addEventListener('click', ()=>{ document.querySelectorAll('.region').forEach(r=>r.classList.add('active')); document.querySelectorAll('.nested').forEach(n=>n.style.display='block'); });
    document.getElementById('collapseAll').addEventListener('click', ()=>{ document.querySelectorAll('.region').forEach(r=>r.classList.remove('active')); document.querySelectorAll('.nested').forEach(n=>n.style.display='none'); document.getElementById('infoBox').style.display='none'; });

    // Search
    document.getElementById('search').addEventListener('input', function(){
      const q = this.value.trim().toLowerCase();
      if(!q){ document.querySelectorAll('.region').forEach(r=>r.style.display='block'); return; }
      document.querySelectorAll('.region').forEach(r=>{
        const text = r.textContent.toLowerCase();
        r.style.display = text.includes(q)?'block':'none';
      });
    });

    // Init
    buildTree();
  </script>
</body>
</html>
